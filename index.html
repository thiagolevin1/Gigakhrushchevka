<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C.H.R.I.S - TERMINAL</title>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap" rel="stylesheet">

<style>
    /* =========================================
       1. ESTILOS GERAIS
       ========================================= */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
        background-color: #050505;
        color: #1aff1a;
        font-family: 'VT323', monospace; 
        height: 100vh;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        user-select: none;
    }

    /* Monitor e Scanlines */
    .monitor-casing { width: 100%; height: 100%; position: relative; background: radial-gradient(circle, #001400 0%, #000000 100%); overflow: hidden; }
    .scanlines { position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.2)); background-size: 100% 4px; pointer-events: none; z-index: 99; }
    .glow-layer { position: absolute; inset: 0; text-shadow: 0 0 4px #1aff1a, 0 0 8px #1aff1a; padding: 40px; z-index: 10; animation: flicker 0.15s infinite; display: flex; flex-direction: column; }
    @keyframes flicker { 0% { opacity: 0.96; } 50% { opacity: 1; } 100% { opacity: 0.94; } }

    /* =========================================
       2. EFEITOS
       ========================================= */
    .glitch-text { animation: glitch 0.2s linear infinite; color: #fff; }
    @keyframes glitch {
        0% { transform: translate(0); } 20% { transform: translate(-2px, 2px); }
        40% { transform: translate(-2px, -2px); } 60% { transform: translate(2px, 2px); }
        80% { transform: translate(2px, -2px); } 100% { transform: translate(0); }
    }
    .chaos-letters { display: inline-block; color: #ff0000; font-weight: bold; font-family: 'Courier Prime', monospace; text-shadow: 2px 0px 5px red; }
    .glitching-number { color: #ff3333; font-weight: bold; display: inline-block; }
    
    .alert-red { color: #ff3333; text-shadow: 0 0 5px red; font-weight: bold; border-color: #ff3333; }
    .alert-normal { border-color: #1aff1a; }

    /* Tema Soviético */
    .soviet-theme {
        color: #ff3333 !important;
        text-shadow: 0 0 5px red !important;
        font-family: 'Courier Prime', monospace;
    }
    .soviet-border { border-color: #ff3333 !important; }
    .soviet-p { margin-bottom: 20px; line-height: 1.5; text-align: justify; }

    /* Tela de Caos (Kian) */
    #chaos-screen {
        position: absolute; inset: 0; background: black; z-index: 200;
        display: none; justify-content: center; align-items: center;
        flex-direction: column; overflow: hidden;
        font-family: 'Courier Prime', monospace;
        color: white;
    }
    .chaos-background {
        position: absolute; inset: 0; 
        font-size: 14px; line-height: 14px; 
        word-break: break-all; opacity: 0.5;
        color: #333;
    }
    .kian-message {
        position: relative; z-index: 201; 
        font-size: 3rem; text-align: center;
        color: white; text-shadow: 0 0 10px white;
    }

    /* =========================================
       3. TELAS
       ========================================= */
    .screen-section { display: none; height: 100%; width: 100%; flex-direction: column; }
    
    #start-screen { position: absolute; inset: 0; z-index: 100; background: black; display: flex; justify-content: center; align-items: center; cursor: pointer; }
    #start-message { animation: blink 1s infinite; font-size: 2rem; border: 2px solid #1aff1a; padding: 20px; }

    #logo-screen { flex: 1; display: flex; justify-content: center; align-items: center; font-size: 4rem; letter-spacing: 2px; text-align: center; }
    #code-screen { flex: 1; overflow: hidden; font-size: 1.2rem; display: flex; align-items: flex-end; white-space: pre-wrap; word-break: break-all; }
    
    #vault-boy-screen { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; width: 100%; }
    .ascii-art { font-size: 6px; line-height: 6px; white-space: pre; text-align: center; margin-bottom: 20px; font-family: 'Courier New', monospace; color: #1aff1a; overflow: hidden; }

    .terminal-history { flex: 1; overflow-y: auto; display: flex; flex-direction: column; justify-content: flex-end; margin-bottom: 20px;}
    .output-log { margin-bottom: 5px; font-size: 1.3rem; }
    .input-line { display: flex; font-size: 1.3rem; }
    .hud { border-top: 2px solid #1aff1a; padding-top: 10px; display: flex; justify-content: space-between; font-size: 1.2rem; margin-top: auto; }

    /* Viewer */
    .file-content { overflow-y: auto; padding-right: 10px; font-family: 'Courier Prime', monospace; font-size: 1.1rem; line-height: 1.4; }
    .file-content::-webkit-scrollbar { width: 8px; }
    .file-content::-webkit-scrollbar-track { background: #001400; }
    .file-content::-webkit-scrollbar-thumb { background: #1aff1a; border-radius: 4px; }
    h2 { border-bottom: 2px solid #1aff1a; padding-bottom: 5px; margin-bottom: 15px; margin-top: 20px; }
    .profile-header { display: flex; flex-direction: column; margin-bottom: 20px; border: 1px solid #1aff1a; padding: 15px; }
    .esc-hint { margin-top: 30px; text-align: center; border-top: 1px dashed #1aff1a; padding-top: 10px; opacity: 0.7; width: 100%; }

    /* Centered Screens */
    .center-content { justify-content: center; align-items: center; text-align: center; }
    .big-question { font-size: 2rem; margin-bottom: 20px; }
    .options { font-size: 1.5rem; margin-top: 20px; text-align: left;}
    .options div { margin-bottom: 10px; cursor: pointer; }
    .options div:hover { text-decoration: underline; background-color: rgba(26, 255, 26, 0.1); }
    #countdown-display { font-size: 8rem; font-weight: bold; }
    .smile-face { font-size: 14px; white-space: pre; color: #1aff1a; }
    
    @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
</style>
</head>
<body>

<audio id="snd-boot" src="boot.mp3"></audio> 
<audio id="snd-hum" src="hum.mp3" loop></audio> 
<audio id="snd-key" src="tecla.mp3"></audio> 
<audio id="snd-soviet" src="hino.mp3"></audio> 

<div class="monitor-casing">
    <div class="scanlines"></div>
    
    <div id="start-screen">
        <div id="start-message" class="lang-swap" data-pt="[ APERTE ENTER ]" data-ru="[ НАЖМИТЕ ENTER ]">[ APERTE ENTER ]</div>
    </div>

    <div id="chaos-screen">
        <div id="chaos-bg" class="chaos-background"></div>
        <div id="chaos-msg" class="kian-message" style="display:none;">Saber Tudo é perder tudo</div>
    </div>

    <div class="glow-layer">
        
        <div id="boot-sequence" class="screen-section">
            <div id="logo-screen" style="display:none;"></div>
            <div id="code-screen" style="display:none;"></div>
            <div id="vault-boy-screen" style="display:none;">
                <div class="ascii-art">
####################################################################################################
####################################################################################################
##########MM########################################################################################
##########  ############################################################################  ##########
##########mm--##########################################################################  ##########
############  ########################################################################    ##########
############  ######################################################################@@  MM##########
############  --####################################################################    ############
############    @@##################################################################    ############
############      ################################################################::    ############
############      ############################mm    --############################    ..############
############::    ::####################mm    mm######      ######################    mm############
##########  ##      ##################  ..######MMMM######@@  MM################      ##::##########
##########  ##      ################  ####    ..MMMM::    @@##  ++##############      ##  ##########
####--####  ++@@      ############  ##::  ################..  ##  ##############      ##  ##########
####  ####++####      ##########..--  ::########....MM####@@##  ##  ##########      ##::  ####  ####
####    ######        ##########  mm    ####            --##      ..MM########      mm    ##@@  ####
####++  ####MM  ##      ######@@      @@@@      --++        ##        ######mm    --    mm##    ####
####@@    ##::  MM      ######    ::####    ############    ######    ######      ##    ##++    ####
######    ##--    ..    mm##..    ####++  ################    ####++    ####      --    ##    ++####
######      ##    ##      ++      ####    ################++  ######      ..    MM    ::      ######
######      mm    --            MM####  ++######    ########  ######  ..        ##    ##--    ######
######        ++    MM        ..@@####  mm####        ######  ######                  ..mm    ######
######        ##    ##          ::######..mm            --##  ######--        ##    @@  ##    ######
######..  --  ..                                                        ::    @@    ##  ##    ######
######@@  mm    @@                                                      @@              ##    ######
########  ##    ##                                                      ##..      ##    mm  --######
########  ##                ..                                          ##--      MM    ..  @@######
########  @@      ##        MM                                          mm--    ..          ########
########  ++      @@        ##                                                  ##          ########
########  ..                ##                                        MM        ::          ########
########..              ++++                                          ##    ..              ########
########mm              ##    ##                                        ----MM            ..########
##########              ##  @@                                      ..    ##              ##########
############            ####                                      ::    ..##            ############
##############            ##  mm                                --  ##  ####          ##############
################          ####  ##    MM                          ########          ################
##############mm##          ########mm    mm++        ..##      MM######::        ##################
################  ##          ########  ++                ..::  ########        ##::################
################@@  ##          ######::      @@######--      ########        ##    ################
##################    ##          ######                    ######@@        ##    ##################
####################    --++  ##    ######::              ######    mm          @@##################
####################++          ##..    @@####        ..####      ##    ..      ####################
######################            ####..                      ####mm  ..      ######################
########################            mm######@@..      ++########            mm######################
########################..              ####################                ########################
############################        --      ############..              --##########################
################################      ..####  --####@@  @@####      MM##############################
########################################::################MM@@######################################
                </div>
                <div>VERITAS.VINCIT</div>
            </div>
        </div>

        <div id="login-interface" class="screen-section">
            <div class="terminal-history" id="login-history">
                <div class="output-log lang-swap" 
                     data-pt="C.H.R.I.S BETA 0.0.1 Conectado." 
                     data-ru="К.Р.И.С БЕТА 0.0.1 Подключено.">
                     C.H.R.I.S BETA 0.0.1 Conectado.
                </div>
                <div class="output-log lang-swap" style="color:#ffcc00" data-pt="⚠️ PROTOCOLO DE SEGURANÇA ATIVO" data-ru="⚠️ ПРОТОКОЛ БЕЗОПАСНОСТИ АКТИВЕН">⚠️ PROTOCOLO DE SEGURANÇA ATIVO</div>
                <div class="output-log lang-swap" data-pt="DIGITE O NOME DO AGENTE, DO ARQUIVO OU DA MISSÃO:" data-ru="ВВЕДИТЕ ИМЯ АГЕНТА, ФАЙЛ ИЛИ МИССИЮ:">DIGITE O NOME DO AGENTE, DO ARQUIVO OU DA MISSÃO:</div>
            </div>
            <div class="input-line">
                <span>></span>
                <span id="user-input-display" class="user-text" style="margin-left: 10px;"></span><span style="animation:blink 1s infinite">█</span>
            </div>
            <div class="hud">
                <div class="lang-swap" data-pt="SYNC: 99%" data-ru="СИНХР: 99%">SYNC: 99%</div>
                <div class="lang-swap" data-pt="LOCK: ATIVO" data-ru="БЛОК: АКТИВЕН">LOCK: ATIVO</div>
            </div>
        </div>

        <div id="file-viewer" class="screen-section file-content"></div>

        <div id="soviet-screen" class="screen-section file-content soviet-theme">
            <div class="profile-header soviet-border" style="border-width: 3px; text-align: center;">
                <h1 style="font-size: 3rem;">☭ C.C.C.P. ☭</h1>
                <p class="lang-swap" data-pt="UNIÃO DAS REPÚBLICAS SOCIALISTAS SOVIÉTICAS" data-ru="СОЮЗ СОВЕТСКИХ СОЦИАЛИСТИЧЕСКИХ РЕСПУБЛИК">UNIÃO DAS REPÚBLICAS SOCIALISTAS SOVIÉTICAS</p>
                <p style="font-size: 0.8rem;">1922 - 1991</p>
            </div>
            <div style="padding: 10px 20px;">
                <h2 class="soviet-border lang-swap" data-pt="I. ORIGENS E REVOLUÇÃO" data-ru="I. ПРОИСХОЖДЕНИЕ И РЕВОЛЮЦИЯ">I. ORIGENS E REVOLUÇÃO</h2>
                <p class="soviet-p lang-swap" 
                   data-pt="A União Soviética nasceu das cinzas do Império Russo... (Texto Histórico)..." 
                   data-ru="Советский Союз родился из пепла Российской империи...">
                   A União Soviética nasceu das cinzas do Império Russo, colapsado durante a Primeira Guerra Mundial. Após a Revolução de Outubro de 1917, liderada por Vladimir Lenin e os Bolcheviques, uma sangrenta Guerra Civil consolidou o poder comunista.
                </p>
                <p class="soviet-p">...</p>
            </div>
            <div class="esc-hint soviet-border lang-swap" data-pt="[ ESC para voltar ]" data-ru="[ ESC чтобы вернуться ]">[ ESC para voltar ]</div>
        </div>

        <div id="cylinder-screen" class="screen-section center-content">
            <div class="big-question lang-swap" data-pt="O cilindro de controle foi inserido?" data-ru="Был ли вставлен контрольный цилиндр?">O cilindro de controle foi inserido?</div>
            <div class="big-question" style="color: yellow;">[ Y / N ]</div>
            <div class="esc-hint lang-swap" style="position: absolute; bottom: 50px;" data-pt="[ ESC para voltar ]" data-ru="[ ESC чтобы вернуться ]">[ ESC para voltar ]</div>
        </div>
        <div id="cylinder-fail" class="screen-section center-content">
            <div class="big-question lang-swap" style="color: red; border: 2px solid red; padding: 20px;" data-pt="NECESSÁRIO CILINDRO DE CONTROLE PARA CONTINUAR" data-ru="ДЛЯ ПРОДОЛЖЕНИЯ ТРЕБУЕТСЯ КОНТРОЛЬНЫЙ ЦИЛИНДР">NECESSÁRIO CILINDRO DE CONTROLE PARA CONTINUAR</div>
            <div class="esc-hint lang-swap" style="position: absolute; bottom: 50px;" data-pt="[ ESC para voltar ]" data-ru="[ ESC чтобы вернуться ]">[ ESC para voltar ]</div>
        </div>
        <div id="elevator-screen" class="screen-section">
            <div style="margin-bottom: 30px; border-bottom: 2px solid #1aff1a;">
                <h1 class="lang-swap" data-pt="CONTROLES ELEVADOR GIGA-KHRUSHCHEVKA" data-ru="УПРАВЛЕНИЕ ЛИФТОМ ГИГА-ХРУЩЕВКА">CONTROLES ELEVADOR GIGA-KHRUSHCHEVKA</h1>
            </div>
            <div class="options">
                <div class="lang-swap" data-pt="[1] Superfície / Ejeção" data-ru="[1] Поверхность / Извлечение">[1] Superfície / Ejeção</div>
                <div class="lang-swap" data-pt="[2] Núcleo / Acesso" data-ru="[2] Ядро / Доступ">[2] Núcleo / Acesso</div>
            </div>
            <div class="esc-hint lang-swap" style="position: absolute; bottom: 50px; width: 100%;" data-pt="[ ESC para voltar ]" data-ru="[ ESC чтобы вернуться ]">[ ESC para voltar ]</div>
        </div>
        <div id="countdown-screen" class="screen-section center-content">
            <div class="lang-swap" data-pt="INICIANDO EJEÇÃO EM:" data-ru="НАЧАЛО ИЗВЛЕЧЕНИЯ ЧЕРЕЗ:">INICIANDO EJEÇÃO EM:</div>
            <div id="countdown-display">10</div>
        </div>
        <div id="smile-screen" class="screen-section center-content">
            <div class="ascii-art smile-face">
      . .
      ___
            </div>
            <div class="big-question lang-swap" data-pt="LIBERADOS" data-ru="СВОБОДНЫ">LIBERADOS</div>
            <div class="esc-hint lang-swap" style="position: absolute; bottom: 50px;" data-pt="[ ESC para reiniciar ]" data-ru="[ ESC для перезагрузки ]">[ ESC para reiniciar ]</div>
        </div>
        <div id="core-screen" class="screen-section center-content">
            <div class="almeida-text" id="almeida-content"></div>
            <br><br>
            <div id="welcome-msg" style="display:none; font-size: 2rem;" class="glitch-text lang-swap" data-pt="BEM-VINDOS A GIGAESTRUTURA" data-ru="ДОБРО ПОЖАЛОВАТЬ В ГИГАСТРУКТУРУ">BEM-VINDOS A GIGAESTRUTURA</div>
            <div class="esc-hint lang-swap" style="position: absolute; bottom: 50px;" data-pt="[ ESC para reiniciar ]" data-ru="[ ESC для перезагрузки ]">[ ESC para reiniciar ]</div>
        </div>

    </div>
</div>

<script>
    /* =========================================
       1. BANCO DE DADOS
       ========================================= */
    const DATABASE = {
        // ... (V e Spark continuam iguais) ...
        "v": {
            id: "v",
            risco: "NORMAL",
            header: `
                <p class="lang-swap" data-pt="Nome: Vincent Welles" data-ru="Имя: Винсент Уэллс">Nome: Vincent Welles</p>
                <p class="lang-swap" data-pt="Codinome: V" data-ru="Кодовое имя: V">Codinome: V</p>
                <p class="lang-swap" data-pt="Idade: 27 anos" data-ru="Возраст: 27 лет">Idade: 27 anos</p>
            `,
            conteudo: `<p class="lang-swap" data-pt="Acesse o código anterior para o texto completo..." data-ru="...">...</p>` 
            // NOTA: Para economizar espaço aqui, estou resumindo, mas mantenha o texto completo do V e Spark que mandei antes!
        },
        "spark": {
            id: "spark",
            risco: "ALTO",
            header: `<p class="lang-swap" data-pt="Nome: Elias 'Spark'" data-ru="Имя: Элиас">Nome: Elias 'Spark'</p>`,
            conteudo: `<p>...</p>`
        },

        // --- NOVO AGENTE: KIARA (K) ---
        "k": {
            id: "k",
            risco: "ALTO", // "Potencialmente Perigosa"
            header: `
                <p class="alert-red lang-swap" data-pt="CLASSIFICAÇÃO: POTENCIALMENTE PERIGOSA" data-ru="КЛАССИФИКАЦИЯ: ПОТЕНЦИАЛЬНО ОПАСНА">CLASSIFICAÇÃO: POTENCIALMENTE PERIGOSA</p>
                <br>
                <p class="lang-swap" data-pt="Nome: Kiara" data-ru="Имя: Киара">Nome: Kiara</p>
                <p class="lang-swap" data-pt="Codinome: K" data-ru="Кодовое имя: K">Codinome: K</p>
                <p class="lang-swap" data-pt="Idade: 19 anos" data-ru="Возраст: 19 лет">Idade: 19 anos</p>
                <p class="lang-swap" data-pt="Gênero: Feminino" data-ru="Пол: Женский">Gênero: Feminino</p>
            `,
            conteudo: `
                <h2 class="lang-swap" data-pt="Resumo" data-ru="Резюме">Resumo</h2>
                <p class="lang-swap" 
                   data-pt="Kiara, codinome K, é uma ocultista recrutada sob circunstâncias excepcionais. Vítima de abuso ritualístico e manipulação psicológica, possui conhecimento visceral do Oculto adquirido através da convivência forçada com uma tia cultista." 
                   data-ru="Киара, кодовое имя К, оккультист, завербованный при исключительных обстоятельствах. Жертва ритуального насилия, обладает глубокими знаниями оккультизма, полученными от тети-культистки.">
                   Kiara, codinome K, é uma ocultista recrutada sob circunstâncias excepcionais. Vítima de abuso ritualístico e manipulação psicológica, possui conhecimento visceral do Oculto adquirido através da convivência forçada com uma tia cultista.
                </p>

                <h2 class="lang-swap" data-pt="Histórico Traumático" data-ru="Травматическая История">Histórico Traumático</h2>
                <p class="lang-swap" data-pt="- Perdeu a família aos 6 anos." data-ru="- Потеряла семью в 6 лет.">- Perdeu a família aos 6 anos.</p>
                <p class="lang-swap" data-pt="- Adotada por tia ocultista que a manipulou." data-ru="- Усыновлена тетей-культисткой.">- Adotada por tia ocultista que a manipulou.</p>
                <p class="lang-swap" data-pt="- Coagida a rituais com promessa de reviver a família." data-ru="- Принуждалась к ритуалам.">- Coagida a rituais com promessa de reviver a família.</p>
                <p class="lang-swap alert-red" data-pt="- Vítima de canibalismo involuntário." data-ru="- Жертва недобровольного каннибализма.">- Vítima de canibalismo involuntário.</p>
                <p class="lang-swap" data-pt="- Assassinou a tia em surto de lucidez." data-ru="- Убила тетю в приступе ясности.">- Assassinou a tia em surto de lucidez.</p>

                <h2 class="lang-swap" data-pt="Habilidades" data-ru="Навыки">Habilidades</h2>
                <p class="lang-swap" data-pt="- Rituais de Morte e Sangue." data-ru="- Ритуалы Смерти и Крови.">- Rituais de Morte e Sangue.</p>
                <p class="lang-swap" data-pt="- Manipulação de componentes biológicos." data-ru="- Манипуляция биологическими компонентами.">- Manipulação de componentes biológicos.</p>
                <p class="lang-swap" data-pt="- Improvisação de rituais ofensivos." data-ru="- Импровизация атакующих ритуалов.">- Improvisação de rituais ofensivos.</p>

                <h2 class="lang-swap" data-pt="Personalidade" data-ru="Личность">Personalidade</h2>
                <p class="lang-swap" data-pt="- Trauma profundo (TEPT)." data-ru="- Глубокая травма (ПТСР).">- Trauma profundo (TEPT).</p>
                <p class="lang-swap" data-pt="- Obsessão por 'limpeza' física e espiritual." data-ru="- Одержимость 'чистотой'.">- Obsessão por "limpeza" física e espiritual.</p>
                <p class="lang-swap" data-pt="- Frieza extrema com cultistas." data-ru="- Крайняя холодность к культистам.">- Frieza extrema com cultistas.</p>

                <h2 class="lang-swap" data-pt="Observações" data-ru="Примечания">Observações</h2>
                <p class="lang-swap" data-pt="- Monitoramento constante necessário." data-ru="- Требуется постоянный мониторинг.">- Monitoramento constante necessário.</p>
                <p class="lang-swap" data-pt="- Risco de instabilidade com temas de ressurreição." data-ru="- Риск нестабильности при теме воскрешения.">- Risco de instabilidade com temas de ressurreição.</p>
                <p class="lang-swap alert-red" data-pt="- Extremamente letal. Motivação: Culpa e Vingança." data-ru="- Чрезвычайно смертоносна. Мотивация: Вина и Месть.">- Extremamente letal. Motivação: Culpa e Vingança.</p>
            `
        }
    };
    // ALIAS PARA KIARA FUNCIONAR COM O NOME TAMBÉM
    DATABASE["kiara"] = DATABASE["k"];

    /* =========================================
       CONFIGURAÇÕES E LÓGICA
       ========================================= */
    const sndBoot = document.getElementById('snd-boot');
    const sndHum = document.getElementById('snd-hum');
    const sndKey = document.getElementById('snd-key');
    const sndSoviet = document.getElementById('snd-soviet');
    
    sndBoot.volume = 0.6; sndHum.volume = 0.2; sndKey.volume = 0.4; sndSoviet.volume = 0.6;
    function playKey() { const c = sndKey.cloneNode(); c.volume = 0.3; c.play().catch(e => {}); }

    let state = "START"; let userInput = ""; let language = "PT"; 

    const screens = {
        start: document.getElementById('start-screen'),
        boot: document.getElementById('boot-sequence'),
        login: document.getElementById('login-interface'),
        viewer: document.getElementById('file-viewer'),
        soviet: document.getElementById('soviet-screen'),
        chaos: document.getElementById('chaos-screen'), // Tela Kian
        cylinder: document.getElementById('cylinder-screen'),
        fail: document.getElementById('cylinder-fail'),
        elevator: document.getElementById('elevator-screen'),
        countdown: document.getElementById('countdown-screen'),
        smile: document.getElementById('smile-screen'),
        core: document.getElementById('core-screen')
    };

    screens.start.addEventListener('click', () => { if(state === "START") startBoot(); });

    document.addEventListener('keydown', (e) => {
        if (e.key === "Escape") {
            if (state !== "START" && state !== "BOOT" && state !== "LOGIN" && state !== "CHAOS") {
                resetToTerminal();
                return;
            }
        }
        if (state === "START") { if (e.key === "Enter") startBoot(); }
        else if (state === "LOGIN") { handleLoginInput(e); }
        else if (state === "CYLINDER") {
            if (e.key.toLowerCase() === 'y') { playKey(); changeScreen('elevator'); state = "ELEVATOR"; } 
            else if (e.key.toLowerCase() === 'n') { playKey(); changeScreen('fail'); state = "FAIL"; }
        }
        else if (state === "ELEVATOR") {
            if (e.key === '1') { playKey(); startCountdown(); state = "BUSY"; } 
            else if (e.key === '2') { playKey(); startCoreSequence(); state = "BUSY"; }
        }
    });

    function changeScreen(screenName) {
        Object.values(screens).forEach(s => { if(s) s.style.display = 'none'; });
        if(screens[screenName]) screens[screenName].style.display = 'flex';
    }

    function resetToTerminal() {
        sndSoviet.pause(); sndSoviet.currentTime = 0;
        changeScreen('login');
        state = "LOGIN";
        userInput = "";
        document.getElementById('user-input-display').innerText = "";
        const logHistory = document.getElementById('login-history');
        logHistory.innerHTML += `<div class="output-log" style="opacity:0.6; margin-top:10px;">[ SESSÃO ENCERRADA. RETORNANDO... ]</div>`;
        logHistory.scrollTop = logHistory.scrollHeight;
    }

    /* === BOOT MODIFICADO === */
    function startBoot() {
        state = "BOOT";
        screens.start.style.display = 'none';
        screens.boot.style.display = 'flex';
        sndBoot.play().catch(e => {});
        runBootAnim().then(() => {
            changeScreen('login');
            sndHum.play().catch(e=>{});
            state = "LOGIN";
            startRussianGlitch();
        });
    }

    async function runBootAnim() {
        const logo = document.getElementById('logo-screen');
        const code = document.getElementById('code-screen');
        const vault = document.getElementById('vault-boy-screen');
        const wait = ms => new Promise(r => setTimeout(r, ms));

        // 1. RUSSO PRIMEIRO
        logo.style.display = 'flex'; 
        logo.innerText = "ОРДО РЕАЛИТАС"; // Russo
        logo.classList.add('glitch-text');
        
        await wait(2000);
        
        // 2. PORTUGUÊS POR 1 SEGUNDO
        logo.innerText = "ORDO REALITAS";
        playKey();
        await wait(1000); // Fica 1 segundo na tela
        
        logo.classList.remove('glitch-text');
        logo.style.display = 'none';

        // CARREGANDO CÓDIGO
        code.style.display = 'flex';
        let i = 0;
        let iv = setInterval(() => {
           const hex = Math.random().toString(16).substr(2,4).toUpperCase();
           code.innerText += `LOADING SECTOR ${hex}... OK\n`;
           code.scrollTop = code.scrollHeight;
           if(++i > 20) clearInterval(iv);
        }, 80);
        await wait(6000); code.style.display = 'none';

        vault.style.display = 'flex';
        await wait(5000); vault.style.display = 'none';
    }

    /* === EFEITO KIAN === */
    function startKianSequence() {
        state = "CHAOS";
        screens.chaos.style.display = 'flex'; // Mostra tela preta por cima
        const bg = document.getElementById('chaos-bg');
        const msg = document.getElementById('chaos-msg');
        
        // Gera caracteres aleatórios freneticamente
        let interval = setInterval(() => {
            let chaosText = "";
            const chars = "@#$%&*()_+ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
            for(let i=0; i < 2000; i++) {
                chaosText += chars.charAt(Math.floor(Math.random() * chars.length)) + " ";
            }
            bg.innerText = chaosText;
            playKey();
        }, 50);

        // Após 2 segundos
        setTimeout(() => {
            clearInterval(interval);
            bg.style.display = 'none'; // Some o caos
            msg.style.display = 'block'; // Aparece a frase
            
            // Depois de um tempo, volta (opcional, ou trava aqui)
            setTimeout(() => {
                resetToTerminal();
                bg.style.display = 'block'; 
                msg.style.display = 'none';
                screens.chaos.style.display = 'none';
            }, 4000);
        }, 2000);
    }

    function handleLoginInput(e) {
        if (e.key === "Backspace") {
            userInput = userInput.slice(0, -1);
            playKey();
        } 
        else if (e.key === "Enter") {
            const inputLower = userInput.toLowerCase().trim();
            const logHistory = document.getElementById('login-history');
            logHistory.innerHTML += `<div class="output-log">> ${userInput}</div>`;
            playKey();

            if (["gigaestrutura", "matrioska", "giga-khrushchevka"].includes(inputLower)) {
                logHistory.innerHTML += `<div class="output-log" style="color:#00ff00">ACESSO CONCEDIDO.</div>`;
                state = "BUSY";
                setTimeout(() => { changeScreen('cylinder'); state = "CYLINDER"; }, 1500);
            
            // KIAN GLITCH
            } else if (inputLower === "kian") {
                startKianSequence();

            } else if (["uniao sovietica", "união soviética", "urss", "ussr"].includes(inputLower)) {
                state = "BUSY";
                setTimeout(() => { changeScreen('soviet'); state = "FILE_VIEW"; sndSoviet.play().catch(()=>{}); }, 1000);

            } else if (DATABASE[inputLower]) {
                const data = DATABASE[inputLower];
                const color = data.risco === "ALTO" ? "red" : "#00ff00";
                logHistory.innerHTML += `<div class="output-log" style="color:${color}">ACESSANDO ARQUIVO...</div>`;
                state = "BUSY";
                setTimeout(() => { openFile(inputLower); }, 1000);

            } else {
                logHistory.innerHTML += `<div class="output-log" style="color:red">COMANDO INVÁLIDO.</div>`;
            }
            userInput = "";
            logHistory.scrollTop = logHistory.scrollHeight;
        } 
        else if (e.key.length === 1) { 
            userInput += e.key;
            playKey();
        }
        document.getElementById('user-input-display').innerText = userInput;
    }

    // ... (Resto das funções openFile, startRussianGlitch, etc permanecem iguais) ...
    // Vou incluir aqui para garantir que copiou tudo:
    
    function openFile(agentId) {
        const data = DATABASE[agentId];
        const viewer = screens.viewer;
        const borderClass = data.risco === "ALTO" ? "alert-red" : "alert-normal";
        const borderColor = data.risco === "ALTO" ? "red" : "#1aff1a";
        viewer.innerHTML = `<div class="profile-header ${borderClass}" style="border-color: ${borderColor};">${data.header}</div>${data.conteudo}<div class="esc-hint lang-swap" data-pt="[ ESC para voltar ]" data-ru="[ ESC чтобы вернуться ]">[ ESC para voltar ]</div>`;
        changeScreen('viewer');
        state = "FILE_VIEW";
    }

    function startRussianGlitch() {
        setInterval(() => {
            language = (language === "PT") ? "RU" : "PT";
            document.querySelectorAll('.lang-swap').forEach(el => {
                el.classList.add('glitch-text');
                setTimeout(() => {
                    if (language === "RU") {
                        el.innerText = el.getAttribute('data-ru');
                        el.style.fontFamily = "'Courier Prime', monospace"; 
                    } else {
                        el.innerText = el.getAttribute('data-pt');
                        el.style.fontFamily = "'VT323', monospace";
                    }
                    el.classList.remove('glitch-text');
                }, 200);
            });
        }, 5000);
    }
    
    function startCountdown() {
        changeScreen('countdown');
        let count = 10;
        const display = document.getElementById('countdown-display');
        const timer = setInterval(() => {
            count--; display.innerText = count; playKey();
            if(count <= 0) { clearInterval(timer); changeScreen('smile'); state = "SMILE"; }
        }, 1000);
    }

    function typeText(element, text) {
        return new Promise(resolve => {
            let i = 0; const interval = setInterval(() => { element.innerHTML += text.charAt(i); playKey(); i++; if (i >= text.length) { clearInterval(interval); resolve(); } }, 50);
        });
    }

    function startRandomLetterGlitch(element) {
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"; 
        setInterval(() => { let r = ""; for(let i=0; i<9; i++) { r += chars[Math.floor(Math.random() * chars.length)]; } element.innerText = r; }, 80); 
    }

    async function startCoreSequence() {
        changeScreen('core');
        state = "CORE";
        const container = document.getElementById('almeida-content');
        container.innerHTML = ""; 
        await typeText(container, "Eu vi o Log da Unidade 7.892. Vocês entendem agora? Não dá para lutar contra a obra. Ela é grande demais. A única chance é matar o ");
        container.innerHTML += ' <span id="chaos-letters" class="chaos-letters"></span>'; 
        startRandomLetterGlitch(document.getElementById('chaos-letters'));
        playKey();
        await typeText(container, ". Eu estou no Nível ");
        container.innerHTML += `<span id="lvl-glitch" class="glitching-number">000</span>`;
        setInterval(() => { const el = document.getElementById('lvl-glitch'); if(el) el.innerText = Math.floor(Math.random() * 999); }, 100);
        setTimeout(() => { document.getElementById('welcome-msg').style.display = 'block'; }, 2000);
    }
</script>

</body>
</html>
